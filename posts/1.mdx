---
title: "理解前端基础渲染模式"
date: '2022-03-01'
tag: 'concept'
published: true
---
理解CSR、SSR、同构、静态化

<h2>渲染的概念</h2>
渲染理解为：将页面数据和页面模版组装成html的过程。
<Planet>data + template = html</Planet>

<h2>客户端渲染（CSR）</h2>
客户端渲染就是 data + template = html 过程在客户端进行。服务器直接转发静态的html资源

常见的形式
打包的时候生成只有css, js等外链接标签的空白页面。客户端在请求时，服务端不做任何处理，直接以原文件的形式返回给客户端，客户端获取到页面后，在加载完js后在通过js来渲染页面内容

优势：
- 服务器压力小，只用进行转发较小的静态页面
- 前后端分离，代码逻辑更清晰，不需要考虑代码能不能在服务端运行，不需要考虑服务端的一些注意事项。
- 可以进行局部刷新，无需每次请求完整页面。交互好可以实现各种效果

劣势：
- 不利于SEO: 网络爬虫可能看不到完整的程序源码，获取不到页面的关键信息。不过现在有的搜索引擎也可以了。
- 首屏渲染慢：渲染前需要下载一堆js和css,而且很多并不是首页需要的js和css，不过按需加载也可以加快首屏加载，下载js和解析js的时间成本都不太低

<h2>服务端渲染</h2>
data + html的过程在服务器端进行。客户端不需要渲染页面。
服务器渲染模式下，当用户第一次请求页面时，由服务器把需要的组件或者页面渲染成html字符串，然后把它返回给客户端。客户端拿到手，是可以直接渲染然后呈现给用户的html内容，不需要为了生成DOM内容自己再去一遍JS代码。使用服务器端渲染的网站，可以说是所见即所得。页面上呈现的内容在html源码里也能找到

优点：
- 首屏渲染快
- 利于SEO
- 可以生成静态化文件
- 可以生成缓存片段
- 客户端资源更小，对用户来说更节能

劣势：
- 传统服务器端渲染的用户体验较差，不容易维护。通常前端为了改html,css，后端也需要修改。
- 服务器压力大，可以用静态化来解决
- 需要考虑服务端的一些注意事项

<h2>为什么要使用SSR</h2>
- 提升首屏加载速度
- 优化SEO
什么是同构
同构是指写一份代码但可以同时在浏览器和服务器中运行的应用。为了同时拥有SSR和CSR的特点。当前流行的方案就是SSR+CSR 同构。比如现在较流行的Next.js

<h2>认识同构</h2>
同构应用原理的核心在于虚拟DOM.虚拟DOM的优点在于
1. 因为操作DOM树是高耗时的操作，尽量减少DOM树操作能优化网页性能。而DOM Diff算法能找出2个不同Object的最小差异。得出最小DOM操作
2. 虚拟DOM的在渲染的时候不仅仅可以通过操作DOM树来表示结果，也能有其他的表示方法。例如虚拟DOM渲染字符串（服务器渲染）等

构建同构应用的最终目的是从一份源代码中构建出2份Javadcript代码，一份用于在node环境中运行渲染html,其中用于在node环境的Javascript需要注意：
1. 不能包含浏览器环境提供的API
2. 不能建议包含css代码，因为服务器端渲染的目的是渲染html内容，渲染出css代码会增加额外的计算量。影响服务端渲染，因此建议css需要用外联方式
3. 不能像用于浏览器环境的输出代码那样把node_modules里的第三方模块和nodejs原生模块打包进去。而是需要分开进行打包，客户端打包一份和服务器打包一份或者打包的时候区分各自运行的文件